<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FamilyBudget API Tester</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Sử dụng font Inter cho thẩm mỹ */
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen p-4 sm:p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
      <h1
        class="text-3xl sm:text-4xl font-extrabold text-indigo-700 mb-6 border-b pb-2"
      >
        FamilyBudget API Tester
      </h1>
      <p class="text-gray-600 mb-6">
        Sử dụng trang này để kiểm tra các endpoint của API Server đang chạy trên
        Express.js.
        <span class="font-semibold text-red-500 block mt-1">
          Đảm bảo API Server đang chạy tại cổng <code id="api-port">6000</code>.
        </span>
      </p>

      <!-- Cấu hình Server -->
      <div class="bg-indigo-50 p-4 rounded-lg mb-6 shadow-inner">
        <label
          for="api-base-url"
          class="block text-sm font-medium text-indigo-800 mb-1"
          >Cấu hình URL API:</label
        >
        <input
          type="text"
          id="api-base-url"
          value="http://localhost:6000"
          class="w-full p-2 border border-indigo-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out"
        />
      </div>

      <!-- Khu vực kiểm tra -->
      <div class="space-y-6">
        <!-- Test Endpoint 1: Root / -->
        <div class="bg-gray-100 p-4 rounded-lg shadow-md">
          <h2 class="text-xl font-bold text-gray-800 mb-3">
            GET / (Kiểm tra kết nối)
          </h2>
          <button
            onclick="testApi('/')"
            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-lg"
          >
            Chạy GET /
          </button>
        </div>

        <!-- Test Endpoint 2: /users -->
        <div class="bg-gray-100 p-4 rounded-lg shadow-md">
          <h2 class="text-xl font-bold text-gray-800 mb-3">
            GET /users (Lấy danh sách người dùng)
          </h2>
          <button
            onclick="testApi('/users')"
            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-lg"
          >
            Chạy GET /users
          </button>
          <p class="text-sm text-gray-500 mt-2">
            (Yêu cầu kết nối Firestore qua Firebase Admin SDK)
          </p>
        </div>

        <!-- Test Endpoint 3: POST /transactions (Mock) -->
        <div class="bg-gray-100 p-4 rounded-lg shadow-md">
          <h2 class="text-xl font-bold text-gray-800 mb-3">
            Mock POST /transactions
          </h2>
          <textarea
            id="post-body"
            class="w-full h-32 p-3 border border-gray-300 rounded-md mb-3"
            placeholder='{"amount": 500000, "type": "Expense", "description": "Testing data"}'
          >
{
"amount": 500000, 
"type": "Expense", 
"description": "Test Transaction"
}</textarea
          >
          <button
            onclick="testPostApi('/transactions')"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-lg"
          >
            Chạy Mock POST /transactions
          </button>
          <p class="text-sm text-gray-500 mt-2">
            (Endpoint này chưa được code trong file index.js của bạn, nó sẽ trả
            về lỗi 404 hoặc CORS nếu bạn chưa xử lý)
          </p>
        </div>
      </div>

      <!-- Khu vực Kết quả -->
      <div class="mt-8">
        <h2 class="text-2xl font-extrabold text-gray-800 mb-4">Kết quả API</h2>
        <div
          id="status-display"
          class="p-3 mb-4 rounded-lg font-semibold transition duration-300 shadow-lg"
        >
          Chưa có yêu cầu nào được gửi.
        </div>
        <pre
          id="api-result"
          class="bg-gray-800 text-green-400 p-4 rounded-lg overflow-x-auto text-sm shadow-xl whitespace-pre-wrap"
        >
Đợi kết quả trả về...
            </pre
        >
      </div>
    </div>

    <script>
      const resultDisplay = document.getElementById("api-result");
      const statusDisplay = document.getElementById("status-display");
      const baseUrlInput = document.getElementById("api-base-url");

      function updateStatus(message, type = "info") {
        statusDisplay.textContent = message;
        statusDisplay.className =
          "p-3 mb-4 rounded-lg font-semibold transition duration-300 shadow-lg";

        if (type === "success") {
          statusDisplay.classList.add("bg-green-100", "text-green-800");
        } else if (type === "error") {
          statusDisplay.classList.add("bg-red-100", "text-red-800");
        } else {
          statusDisplay.classList.add("bg-blue-100", "text-blue-800");
        }
      }

      async function testApi(endpoint) {
        const baseUrl = baseUrlInput.value.trim();
        const url = `${baseUrl}${endpoint}`;
        resultDisplay.textContent = "Đang gửi yêu cầu...";
        updateStatus(`Đang gọi: GET ${url}`, "info");

        try {
          const response = await fetch(url);
          const data = await response.json();

          resultDisplay.textContent = JSON.stringify(data, null, 2);

          if (response.ok) {
            updateStatus(
              `Thành công! Mã trạng thái: ${response.status}`,
              "success"
            );
          } else {
            updateStatus(
              `Lỗi Server! Mã trạng thái: ${response.status}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          resultDisplay.textContent = `LỖI KẾT NỐI (Kiểm tra console để biết chi tiết): \n\n${error.message}`;
          updateStatus(
            "LỖI KẾT NỐI! Server không phản hồi. Kiểm tra URL và Port.",
            "error"
          );
        }
      }

      async function testPostApi(endpoint) {
        const baseUrl = baseUrlInput.value.trim();
        const url = `${baseUrl}${endpoint}`;
        const bodyContent = document.getElementById("post-body").value;

        resultDisplay.textContent = "Đang gửi yêu cầu POST...";
        updateStatus(`Đang gọi: POST ${url}`, "info");

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: bodyContent,
          });

          const data = await response.json();

          resultDisplay.textContent = JSON.stringify(data, null, 2);

          if (response.ok) {
            updateStatus(
              `Thành công! Mã trạng thái: ${response.status}`,
              "success"
            );
          } else {
            updateStatus(
              `Lỗi Server! Mã trạng thái: ${response.status}`,
              "error"
            );
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          resultDisplay.textContent = `LỖI KẾT NỐI: \n\n${error.message}`;
          updateStatus("LỖI KẾT NỐI! Server không phản hồi.", "error");
        }
      }
    </script>
  </body>
</html>
